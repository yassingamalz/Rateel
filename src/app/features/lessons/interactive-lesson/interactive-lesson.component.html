<div class="interactive-lesson" [ngClass]="currentTheme" [class.is-recording]="state.isRecording"
  [class.lesson-completed]="state.isCompleted">
  <!-- Ambient Background -->
  <div class="ambient-background">
    <div class="pattern-overlay"></div>
    <div class="ambient-glow"></div>
  </div>

  <!-- Progress Bar -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="state.progress"></div>
      <span class="progress-text">{{state.progress | number:'1.0-0'}}<span class="percent">%</span></span>
    </div>
  </div>

  <!-- Theme Toggle -->
  <div class="theme-toggle-wrapper">
    <button class="theme-toggle-btn" (click)="toggleTheme()">
      <i class="fas" [class.fa-sun]="currentTheme === 'theme-dark'" [class.fa-moon]="currentTheme === 'theme-light'"></i>
    </button>
  </div>

  <!-- Verses Container -->
  <app-verses-container 
    [verses]="verses" 
    [currentVerseIndex]="state.currentVerseIndex"
    [currentWordIndex]="state.currentWordIndex"
    [recognizedWords]="state.recognizedWords"
    (verseChange)="onVerseChange($event)">
  </app-verses-container>

  <!-- Recording Controls -->
  <app-recording-controls
    [isRecording]="state.isRecording"
    [isCompleted]="state.isCompleted"
    (recordingToggle)="toggleRecording()">
  </app-recording-controls>

  <!-- Help Tips -->
  <app-help-tips
    [hasStartedLesson]="hasStartedLesson"
    [isRecording]="state.isRecording">
  </app-help-tips>

  <!-- Feedback Overlay -->
  <app-feedback-overlay *ngIf="state.feedback" [message]="state.feedback">
  </app-feedback-overlay>

  <!-- Completion Screen -->
  <app-completion-screen *ngIf="state.isCompleted" [isCompleted]="state.isCompleted">
  </app-completion-screen>
</div>