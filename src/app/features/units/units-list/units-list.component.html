<!-- units-list.component.html -->
<div class="units-page" dir="rtl">
  <header class="units-header">
    <div class="header-content">
      <h1 class="page-title">وحدات المقرر</h1>
      <button class="change-course-btn" routerLink="/courses">
        <i class="fas fa-exchange-alt"></i>
        تغيير المقرر
      </button>
    </div>
  </header>

  <div class="units-container"
       #unitsContainer
       [class.dragging]="isDragging"
       (mousedown)="onMouseDown($event)"
       (mousemove)="onMouseMove($event)"
       (mouseup)="onMouseUp()"
       (mouseleave)="onMouseLeave()"
       (touchstart)="onTouchStart($event)"
       (touchmove)="onTouchMove($event)"
       (touchend)="onTouchEnd()">
    <div class="units-wrapper">
      <ng-container *ngFor="let unit of units$ | async; let i = index">
        <div class="unit-circle-wrapper">
          <div class="unit-circle"
               [class.unit-circle--locked]="unit.isLocked"
               [class.unit-circle--completed]="unit.isCompleted"
               (click)="onUnitSelected(unit)">
            
            <!-- Circular Progress Ring -->
            <svg class="progress-ring" viewBox="0 0 100 100">
              <!-- Background circle -->
              <circle class="progress-ring__circle--bg"
                      cx="50" cy="50" r="46"
                      stroke-width="4"/>
              <!-- Progress circle -->
              <circle class="progress-ring__circle--progress"
                      cx="50" cy="50" r="46"
                      stroke-width="4"
                      *ngIf="unit.progress! > 0"
                      [style.strokeDasharray]="getProgressCircleValue(unit.progress || 0)"/>
            </svg>
            
            <!-- Main Content -->
            <div class="unit-circle__content">
              <!-- Type Icon -->
              <div class="unit-circle__icon">
                <i class="fas" [ngClass]="getUnitTypeIcon(unit.type)"></i>
              </div>

              <!-- Lock Overlay -->
              <div class="unit-circle__lock" *ngIf="unit.isLocked">
                <i class="fas fa-lock"></i>
              </div>

              <!-- Title -->
              <h3 class="unit-circle__title">{{ unit.title }}</h3>
            </div>
          </div>

          <!-- Connector Line -->
          <div class="connector-line" *ngIf="i < (units$ | async)!.length - 1">
            <div class="connector-line__progress" 
                 [style.width.%]="getConnectorProgress(unit, (units$ | async)![i + 1])">
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>